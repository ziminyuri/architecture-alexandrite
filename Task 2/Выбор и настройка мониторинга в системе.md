## Мотивация по добавлению мониторинга 
1. Оперативаное выявление текущих дефекторв или дефектов после установки релиза.
2. Прогнозирование деградации системы при разных нагрузках
3. Дальнейшая настройка алертинга для оперативного реагирования

## Выбор подхода к мониторингу
1. Запрос к БД/S3 метод USE.
2. Брокер метод USE.
3. Для сервисов API метод RED и USE.

## Метрики
1. БД
   1. Memory Utilisation for shop db instance и Memory Utilisation for MES db instance (Utilization). 
      - Показывает использование памяти базой данных.
      - Подход: USE
   2. Number of connections for shop db instance и Number of connections for MES db instance (Utilization/Saturation)
      - Показывает количество активных соединений с базой данных. Превышение лимита соединений может привести к отказу в обслуживании.
      - Подход: USE
   3. Size of shop db instance и Size of MES db instance (Utilization)
      - Показывает размер базы данных.
      - Подход: USE
2. S3
   1. Size of S3 storage (Utilization)
      - Показывает занятое пространство в хранилище. 
      - Подход: USE
3. Брокер
   1. Number of dead-letter-exchange letters in RabbitMQ (Errors)
      - Показывает количество сообщений, не доставленных в основные очереди и перенаправленных в dead-letter exchange
      - Подход: USE
   2. Number of message in flight in RabbitMQ (Saturation)
      - Показывает количество сообщений, полученных брокером, но еще не обработанных потребителями. 
      - Подход: USE
4. API сервисы
   1. Number of requests (RPS) (Request Rate). Метрики: Number of requests (RPS) for internet shop API, Number of requests (RPS) for CRM API, Number of requests (RPS) for MES API
      - Показывает текущую нагрузку на API.
      - Подход: RED
   2. Number of requests (RPS) (Request Rate). Метрики: Number of requests (RPS) per user for internet shop API, Number of requests (RPS) per user for CRM API, Number of requests (RPS) per user for MES API
      - Позволяет выявить пользователей, создающих аномальную нагрузку.
      - Подход: RED
   3. CPU % (Utilization). Метрики: CPU % for shop API, CPU % for CRM API, CPU % for MES API
      - Показывает загрузку процессора сервисом.
      - Подход: USE
   4. Memory Utilisation (Utilization). Метрики: Memory Utilisation for shop API, Memory Utilisation for CRM API, Memory Utilisation for MES API.
      - Показывает использование памяти сервисом.
      - Подход: USE
   5. Response time (latency) (Duration). Метрики: Response time (latency) for shop API, Response time (latency) for CRM API, Response time (latency) for MES API.
      - Показывает скорость ответа API.
      - Подход: RED
   6. Number of HTTP (Request Rate/Success). Метрики: Number of HTTP 200 for shop API, Number of HTTP 200 for CRM API, Number of HTTP 200 for MES API, Number of HTTP 500 for shop API, Number of HTTP 500 for CRM API, Number of HTTP 500 for MES API
      - Показывает кол-во ошибок и успешных ответов
      - Подход: RED

## План действий
**I. Настройка инфраструктуры мониторинга:**

1.  **Выбор и развертывание time-series базы данных (TSDB):**
    *   **Задача:** Создать инстанс TSDB с использованием подходящей технологии (например, Prometheus) для хранения и анализа метрик.
    *   **Детали:**
        *   Определить требования к производительности и масштабируемости TSDB.
        *   Выбрать оптимальную технологию TSDB, учитывая стоимость, сложность настройки и интеграцию с существующей инфраструктурой.
        *   Настроить резервное копирование и восстановление TSDB.
2.  **Выбор и развертывание системы визуализации:**
    *   **Задача:** Настроить инструмент визуализации (например, Grafana) для отображения метрик и создания дашбордов.
    *   **Детали:**
        *   Интегрировать систему визуализации с выбранной TSDB.
        *   Разработать дашборды для отображения ключевых метрик по каждому сервису.
        *   Настроить оповещения на основе заданных пороговых значений метрик.
3.  **Настройка сбора метрик:**
    *   **Задача:** Реализовать сбор метрик с различных компонентов системы (API сервисы, RabbitMQ, базы данных, S3).
    *   **Детали:**
        *   Использовать подходящие инструменты для сбора метрик 
        *   Разработать пользовательские метрики для конкретных бизнес-требований.
        *   Обеспечить безопасную передачу метрик в TSDB.

**II. Настройка мониторинга для сервисов:**

1.  **API сервисы (Интернет-магазин, CRM, MES):**
    *   **Задача:** Реализовать мониторинг API сервисов, используя подход RED (Request Rate, Errors, Duration).
    *   **Детали:**
        *   Сбор метрик RPS, количества ошибок (5xx, 4xx), времени ответа (P50, P95, P99).
        *   Мониторинг загрузки ЦП и использования памяти.
        *   Разработать алерты для выявления аномалий и проблем с производительностью.
2.  **RabbitMQ:**
    *   **Задача:** Реализовать мониторинг RabbitMQ, используя подход USE (Utilization, Saturation, Errors).
    *   **Детали:**
        *   Сбор метрик количества сообщений в очереди, количества потерянных сообщений, времени задержки сообщений, использования диска и памяти.
        *   Разработать алерты для выявления перегрузки, потери сообщений и других проблем.
3.  **Базы данных (Shop DB, MES DB):**
    *   **Задача:** Реализовать мониторинг баз данных, используя подход USE (Utilization, Saturation, Errors).
    *   **Детали:**
        *   Сбор метрик использования ЦП и памяти, размера базы данных, количества активных соединений, времени выполнения запросов.
        *   Разработать алерты для выявления медленных запросов, перегрузки и других проблем.
4.  **S3 хранилище:**
    *   **Задача:** Реализовать мониторинг S3 хранилища, используя подход USE (Utilization, Saturation, Errors).
    *   **Детали:**
        *   Сбор метрик размера хранилища, количества запросов, ошибок доступа.
        *   Разработать алерты для выявления нехватки места, ошибок доступа и других проблем.
